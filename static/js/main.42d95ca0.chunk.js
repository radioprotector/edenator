(this.webpackJsonpedenator=this.webpackJsonpedenator||[]).push([[0],{54:function(e,r,t){},61:function(e,r,t){},66:function(e,r,t){},67:function(e,r,t){"use strict";t.r(r);var n,o=t(5),a=t.n(o),i=t(41),s=t.n(i),c=(t(54),t(13)),l=t(16),u=t.n(l),f=t(20),d=t(11),h=t(42),b=t(1),p=t(2);!function(e){e.C_Major="1d",e.A_Minor="1m",e.G_Major="2d",e.E_Minor="2m",e.D_Major="3d",e.B_Minor="3m",e.A_Major="4d",e.F_Sharp_Minor="4m",e.E_Major="5d",e.C_Sharp_Minor="5m",e.B_Major="6m",e.G_Sharp_Minor="6d",e.F_Sharp_Major="7d",e.D_Sharp_Minor="7m",e.D_Flat_Major="8d",e.B_Flat_Minor="8m",e.A_Flat_Major="9d",e.F_Minor="9m",e.E_Flat_Major="10d",e.C_Minor="10m",e.B_Flat_Major="11d",e.G_Minor="11m",e.F_Major="12d",e.D_Minor="12m",e.OffKey="0"}(n||(n={}));var m=function(){function e(){Object(b.a)(this,e),this.title="",this.artist="",this.bpm=120,this.length=0,this.key=null,this.subBass=[],this.bass=[],this.beat=[],this.treble=[],this.trackHash=1,this.isEmpty=!1}return Object(p.a)(e,[{key:"secondsPerMeasure",get:function(){return 240/this.bpm}},{key:"getTrackRandomInt",value:function(e,r){return this.getTrackSeededRandomInt(e,r,0)}},{key:"getTrackSeededRandomInt",value:function(e,r,t){var n=(Math.sin(this.trackHash+t)+1)/2;return e+Math.floor(n*(r-e+1))}},{key:"getTrackSeededRandomFloat",value:function(e,r,t){return e+(Math.sin(this.trackHash+t)+1)/2*(r-e)}}]),e}(),j=new m;j.isEmpty=!0;var M=44100,y=Object.values(n),v={"1A":n.G_Sharp_Minor,"G#m":n.G_Sharp_Minor,Abm:n.G_Sharp_Minor,"1B":n.B_Major,B:n.B_Major,"2A":n.D_Sharp_Minor,"D#m":n.D_Sharp_Minor,Ebm:n.D_Sharp_Minor,"2B":n.F_Sharp_Major,"F#":n.F_Sharp_Major,Gb:n.F_Sharp_Major,"3A":n.B_Flat_Minor,"A#m":n.B_Flat_Minor,Bbm:n.B_Flat_Minor,"3B":n.D_Flat_Major,"C#":n.D_Flat_Major,Db:n.D_Flat_Major,"4A":n.F_Minor,Fm:n.F_Minor,"4B":n.A_Flat_Major,"G#":n.A_Flat_Major,Ab:n.A_Flat_Major,"5A":n.C_Minor,Cm:n.C_Minor,"5B":n.E_Flat_Major,"D#":n.E_Flat_Major,Eb:n.E_Flat_Major,"6A":n.G_Minor,Gm:n.G_Minor,"6B":n.B_Flat_Major,"A#":n.B_Flat_Major,Bb:n.B_Flat_Major,"7A":n.D_Minor,Dm:n.D_Minor,"7B":n.F_Major,F:n.F_Major,"8A":n.A_Minor,Am:n.A_Minor,"8B":n.C_Major,C:n.C_Major,"9A":n.E_Minor,Em:n.E_Minor,"9B":n.G_Major,G:n.G_Major,"10A":n.B_Minor,Bm:n.B_Minor,"10B":n.D_Major,D:n.D_Major,"11A":n.F_Sharp_Minor,"F#m":n.F_Sharp_Minor,Gbm:n.F_Sharp_Minor,"11B":n.A_Major,A:n.A_Major,"12A":n.C_Sharp_Minor,"C#m":n.C_Sharp_Minor,Dbm:n.C_Sharp_Minor,"12B":n.E_Major,E:n.E_Major,o:n.OffKey,O:n.OffKey};function g(e){return new Promise((function(r,t){new h.Reader(e).read({onSuccess:function(e){r(e)},onError:function(e){var r=new Error(e.info);r.name="MediaTagsError",t(r)}})}))}function w(e,r,t){if(null!==r){var n,o=Object(d.a)(r);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(a in e.tags)return e.tags[a]}}catch(b){o.e(b)}finally{o.f()}}if(null!==t&&"TXXX"in e.tags){var i=[];i=Array.isArray(e.tags.TXXX)?e.tags.TXXX:[e.tags.TXXX];var s,c=Object(d.a)(t);try{for(c.s();!(s=c.n()).done;){var l,u=s.value,f=Object(d.a)(i);try{for(f.s();!(l=f.n()).done;){var h=l.value;if("user_description"in h.data&&"data"in h.data&&h.data.user_description===u)return{id:u,description:u,data:h.data.data}}}catch(b){f.e(b)}finally{f.f()}}}catch(b){c.e(b)}finally{c.f()}}return null}function _(e){var r=w(e,["BPM","TBPM","TMPO"],["fBPM"]),t="";return null===r?null:("string"===typeof(t=r.data)&&(t=parseFloat(t)),"number"===typeof t&&Number.isFinite(t)&&t>0?t:null)}function C(e){var r=w(e,["KEY","TKEY"],["INITIAL KEY","INITIAL_KEY"]),t="";return null===r?null:((t=(t=r.data.toString()).replace(/ /,""))in v&&(t=v[t]),null!==t&&y.includes(t.trim())?t:null)}function O(e){return new window.OfflineAudioContext(1,M,M).decodeAudioData(e).then((function(e){var r=new window.OfflineAudioContext(1,e.length,M),t=r.createBufferSource();return t.buffer=e,t.connect(r.destination),t.start(0),r.startRendering()})).then((function(e){for(var r=e.getChannelData(0),t=new Float32Array(r),n=Math.floor(882),o=0,a=0;a<r.length;a+=n){var i,s=0,c=0;for(c=0;c<n&&a+c<r.length;c++)s+=r[a+c]*r[a+c];for(i=Math.sqrt(s/(c+1)),o=Math.max(i,.9*o),c=0;c<n&&a+c<r.length;c++)t[a+c]=o}return t}))}function x(e,r,t){var n=new window.OfflineAudioContext(1,r.length,M);return n.decodeAudioData(e).then((function(e){var r=n.createBufferSource(),o=r;if(r.buffer=e,null!=t.minFrequency){var a=new BiquadFilterNode(n,{type:"highpass",Q:1,frequency:t.minFrequency});o.connect(a),o=a}if(null!=t.maxFrequency){var i=new BiquadFilterNode(n,{type:"lowpass",Q:1,frequency:t.maxFrequency});o.connect(i),o=i}return o.connect(n.destination),r.start(0),n.startRendering()})).then((function(e){for(var n=e.getChannelData(0),o=[],a={},i=0;i<n.length;)if(0!==r[i]){var s=Math.abs(n[i]),c=s/r[i];if(s>=t.initialAbsoluteThreshold&&c>=t.initialRelativeThreshold){var l={time:i/M,intensity:0,intensityNormalized:0,end:0};do{if(l.intensity=Math.max(l.intensity,s),l.intensityNormalized=Math.max(l.intensityNormalized,c),++i>=n.length||0===r[i])break;c=(s=Math.abs(n[i]))/r[i]}while(s>=t.sustainAbsoluteThreshold&&c>=t.sustainRelativeThreshold);l.end=i/M,o.push(l);var u=l.intensityNormalized.toFixed(2);u in a?a[u]++:a[u]=1,i+=Math.ceil(2756.25)}i++}else i++;var f=Math.ceil(t.expectedMaxPeaksPerMinute*e.duration/60);if(o.length>f){for(var d=Object.keys(a).map((function(e){return{intensity:parseFloat(e),count:a[e]}})).sort((function(e,r){return r.intensity-e.intensity})),h=0,b=d[0].intensity,p=d[0].count;p<f&&h<d.length-1;)h++,b=d[h].intensity,p+=d[h].count;return o.filter((function(e){return e.intensityNormalized>=b}))}return o}))}function k(e,r){if(!e)return null;var t=r/60*45;if(e.length<t)return null;var n={};e.forEach((function(r,t){for(var o=1;o<10&&!(t+o>=e.length);o++){var a=e[t+o].time-r.time,i=a.toFixed(2);a<.25||(i in n?n[i]++:n[i]=1)}}));var o={};Object.keys(n).forEach((function(e){for(var r=60/(parseFloat(e)/M);r<90;)r*=2;for(;r>180;)r/=2;var t=r.toFixed(0);t in o?o[t]+=n[e]:o[t]=n[e]}));var a=Object.keys(o).map((function(e){return{bpm:parseFloat(e),intervals:o[e]}})).sort((function(e,r){return r.bpm-e.bpm})),i=0,s=0,c=0;a.forEach((function(e){e.intervals>i&&(e.bpm,i=e.intervals),s+=e.bpm*e.intervals,c+=e.intervals}));var l=s/c;if(c>2&&a.length>1){for(var u=Math.floor(c/2),f=0;u>0&&f<a.length;)u-=a[f].intervals,f++;0===u?(a[f-1].bpm+a[f].bpm)/2:a[f-1].bpm}return l}function F(){return(F=Object(f.a)(u.a.mark((function e(r){var t,n,o,a,i,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g(r);case 3:t=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 9:return e.next=11,r.arrayBuffer().then((function(e){return O(e)}));case 11:return n=e.sent,o=r.arrayBuffer().then((function(e){return x(e,n,{minFrequency:20,maxFrequency:50,expectedMaxPeaksPerMinute:60,initialAbsoluteThreshold:.4,initialRelativeThreshold:.5,sustainAbsoluteThreshold:.4,sustainRelativeThreshold:.5})})),a=r.arrayBuffer().then((function(e){return x(e,n,{minFrequency:50,maxFrequency:90,expectedMaxPeaksPerMinute:120,initialAbsoluteThreshold:.4,initialRelativeThreshold:.5,sustainAbsoluteThreshold:.4,sustainRelativeThreshold:.5})})),i=r.arrayBuffer().then((function(e){return x(e,n,{minFrequency:90,maxFrequency:200,expectedMaxPeaksPerMinute:300,initialAbsoluteThreshold:.4,initialRelativeThreshold:.5,sustainAbsoluteThreshold:.4,sustainRelativeThreshold:.5})})),s=r.arrayBuffer().then((function(e){return x(e,n,{minFrequency:2048,maxFrequency:null,expectedMaxPeaksPerMinute:120,initialAbsoluteThreshold:.4,initialRelativeThreshold:.5,sustainAbsoluteThreshold:.25,sustainRelativeThreshold:.35})})),e.abrupt("return",Promise.all([t,o,a,i,s]).then((function(e){var t,o,a,i=Object(c.a)(e,5),s=i[0],l=i[1],u=i[2],f=i[3],d=i[4],h=n.length/M,b=C(s),p=_(s);p||(p=k(f,h));var j=new m;return j.title=null!==(t=s.tags.title)&&void 0!==t?t:"Unknown Title",j.artist=null!==(o=s.tags.artist)&&void 0!==o?o:"Unknown Artist",j.bpm=null!==(a=p)&&void 0!==a?a:120,j.length=h,j.key=b,j.subBass=l,j.bass=u,j.beat=f,j.treble=d,j.trackHash=Math.floor(r.lastModified+r.size)+1,j})));case 17:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var S=t(31),A=t.n(S),B=t(43),L=t(0),T=new L.Color(0),E=new L.Color(16777215);function P(e){return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function R(e){return.2126*P(e.r)+.7152*P(e.g)+.0722*P(e.b)}var D=.43;function G(e,r,t){var n,o,a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return null===i&&(i=new L.Color(r).lerp(t,.5)),R(r)<D?(n=E,o=new L.Color(r).lerp(T,.3),a=new L.Color(r).lerp(E,.2)):(n=T,o=new L.Color(r).lerp(E,.3),a=new L.Color(r).lerp(T,.2)),{name:e,bass:{wireframeColor:new L.Color(i).lerp(T,.3),panelColor:new L.Color(i)},beat:{color:new L.Color(r)},treble:{spriteColor:new L.Color(r).lerp(E,.65),spriteTexture:"/edenator/textures/extendring.png",lightColor:new L.Color(r).lerp(E,.75)},frequencyGrid:{lineColor:new L.Color(t)},background:{fillColor:new L.Color(r).lerp(T,.97),sunColor:new L.Color(r).lerp(t,.75).lerp(E,.5),burstLineColor:new L.Color(r).lerp(t,.75).lerp(E,.25),starColor:new L.Color(r).lerp(t,.75).lerp(E,.1),starFlashColor:new L.Color(r).lerp(t,.75)},ui:{textColor:n,backgroundColor:new L.Color(r),disabledBackgroundColor:o,focusBackgroundColor:a,borderColor:new L.Color(t)}}}var q=G("default",new L.Color(16737792),new L.Color(16724787),new L.Color(16750899)),U=G("magenta",new L.Color(16738047),new L.Color(16724889),new L.Color(13311)),V=G("indigo",new L.Color(13369599),new L.Color(6711039),new L.Color(6697983)),I=G("deep blue",new L.Color(13311),new L.Color(13408512),new L.Color(52428)),N=G("mid blue",new L.Color(6724095),new L.Color(6736998),new L.Color(3368703)),z=G("light blue",new L.Color(10079487),new L.Color(16738047),new L.Color(3407667)),W=G("blue-green",new L.Color(65535),new L.Color(13395456),new L.Color(3381657)),X=G("green",new L.Color(65280),new L.Color(16711833),new L.Color(65433)),H=G("yellow-green",new L.Color(10092492),new L.Color(16763955),new L.Color(3394560)),K=G("yellow",new L.Color(16763904),new L.Color(3355647),new L.Color(13421619)),Z=G("orange",new L.Color(16737792),new L.Color(3407871),new L.Color(16711680)),Y=G("red",new L.Color(16711680),new L.Color(10092492),new L.Color(16737945)),J=G("pink",new L.Color(16751052),new L.Color(16724787),new L.Color(13382604)),Q=G("hotdog stand",new L.Color(16711680),new L.Color(16776960)),$=G("fluorescent",new L.Color(16711935),new L.Color(65280)),ee=G("plasma power saver",new L.Color(255),new L.Color(16711935),new L.Color(13369446)),re=[q,U,V,I,N,z,W,X,H,K,Z,Y,J,Q,$,ee];var te,ne=A()(Object(B.subscribeWithSelector)((function(e){return{analysis:j,theme:q,audioLastSeeked:0,setAnalysis:function(r){return e((function(e){e.analysis=r}))},setTheme:function(r){return e((function(e){e.theme=r}))},indicateAudioSeeked:function(){return e((function(e){e.audioLastSeeked=Date.now()}))}}}))),oe=(t(61),t(44)),ae=t(45),ie=t(7),se=new Path2D("M64,12.8C64,5.735 58.265,0 51.2,0L12.8,0C5.735,0 0,5.735 0,12.8L0,51.2C0,58.265 5.735,64 12.8,64L51.2,64C58.265,64 64,58.265 64,51.2L64,12.8Z"),ce=new Path2D("M-0.063,32C-0.063,32 0.1,14.756 0.706,14.762C1.308,14.768 1.352,48.687 2.623,48.679C3.713,48.672 4.033,19.674 6.498,19.72C8.476,19.757 9.898,44.125 11.665,44.137C13.269,44.148 15.225,27.314 18.123,27.262C19.97,27.228 22.316,34.293 24.748,34.262C26.547,34.239 29.486,30.126 31.915,30.179C33.821,30.22 36.836,32.346 39.185,32.262C41.258,32.188 44.23,31.313 45.976,31.262C47.511,31.217 51.354,32.125 53.396,32.058C55.048,32.004 58.987,31.707 60.222,31.672C61.416,31.638 62.61,31.788 63.804,31.845"),le=new Path2D("M25.418,10.25L27.74,9.882L27.993,11.48L29.435,10.745L30.502,12.84L29.06,13.575L30.204,14.719L28.542,16.381L27.398,15.237L26.663,16.679L24.568,15.612L25.303,14.17L23.705,13.917L24.073,11.595L25.671,11.848L25.418,10.25Z"),ue=new Path2D("M44.075,49.242L45.903,47.762L46.921,49.02L47.802,47.663L49.774,48.943L48.893,50.3L50.456,50.719L49.847,52.99L48.284,52.571L48.369,54.187L46.021,54.31L45.936,52.694L44.426,53.274L43.583,51.079L45.094,50.499L44.075,49.242Z");var fe=function(){var e=ne((function(e){return e.theme.ui}));return Object(o.useEffect)((function(){return ne.subscribe((function(e){return e.theme.ui}),(function(e){var r;null===(r=document.querySelector('meta[name="theme-color"]'))||void 0===r||r.setAttribute("content",e.backgroundColor.getStyle());var t=document.createElement("canvas");t.setAttribute("width","64px"),t.setAttribute("height","64px");var n=t.getContext("2d",{alpha:!0,desynchronized:!0});if(n){var o;n.fillStyle=e.backgroundColor.getStyle(),n.fill(se),n.strokeStyle=e.textColor.getStyle(),n.lineWidth=2,n.stroke(ce),n.lineWidth=1,n.stroke(le),n.stroke(ue);var a=t.toDataURL("image/png");null===(o=document.querySelector('link[rel="icon"]'))||void 0===o||o.setAttribute("href",a)}t.remove()}))}),[]),Object(ie.jsx)("style",{type:"text/css",children:Object(ae.a)(te||(te=Object(oe.a)(["\n        html {\n          --ui-color-text: ",";\n          --ui-color-contrast: ",";\n          --ui-color-contrast-disabled: ",";\n          --ui-color-contrast-focus: ",";\n          --ui-color-border: ",";\n      }"])),e.textColor.getStyle(),e.backgroundColor.getStyle(),e.disabledBackgroundColor.getStyle(),e.focusBackgroundColor.getStyle(),e.borderColor.getStyle())})},de=t(15);function he(e){return Array.from(Array(e).keys())}var be=Math.PI/2,pe=15,me=new L.BufferGeometry;me.setFromPoints([new L.Vector3(.5,-.5,.5),new L.Vector3(.5,.5,.5),new L.Vector3(.5,.5,.5),new L.Vector3(-.5,.5,.5),new L.Vector3(-.5,.5,.5),new L.Vector3(-.5,-.5,.5),new L.Vector3(-.5,-.5,.5),new L.Vector3(.5,-.5,.5),new L.Vector3(-.5,.5,.5),new L.Vector3(-.5,.5,-.5),new L.Vector3(-.5,-.5,.5),new L.Vector3(-.5,-.5,-.5),new L.Vector3(.5,.5,.5),new L.Vector3(.5,.5,-.5),new L.Vector3(.5,-.5,.5),new L.Vector3(.5,-.5,-.5),new L.Vector3(.5,-.5,-.5),new L.Vector3(.5,.5,-.5),new L.Vector3(.5,.5,-.5),new L.Vector3(-.5,.5,-.5),new L.Vector3(-.5,.5,-.5),new L.Vector3(-.5,-.5,-.5),new L.Vector3(-.5,-.5,-.5),new L.Vector3(.5,-.5,-.5)]);var je,Me=new L.LineBasicMaterial,ye=new L.PlaneGeometry,ve=new L.MeshBasicMaterial({side:L.DoubleSide,transparent:!0,opacity:.6});function ge(e,r,t,n,o){switch(r.visible=!0,t.visible=!0,n.isEmpty?je.PlaneHidden:n.getTrackSeededRandomInt(je.MIN,je.MAX,o+e)){case je.SegmentHidden:r.visible=!1,t.visible=!1;break;case je.PlaneLeft:t.scale.set(5,pe,1),t.position.set(-1,0,0),t.rotation.set(0,be,0);break;case je.PlaneRight:t.scale.set(5,pe,1),t.position.set(1,0,0),t.rotation.set(0,be,0);break;case je.PlaneFront:t.scale.set(2,pe,1),t.position.set(0,0,2.5),t.rotation.set(0,0,0);break;case je.PlaneTop:t.scale.set(2,5,1),t.position.set(0,7.5,0),t.rotation.set(be,0,0);break;case je.PlaneBottom:t.scale.set(2,5,1),t.position.set(0,-7.5,0),t.rotation.set(be,0,0);break;case je.PlaneHidden:t.visible=!1;break;default:0,t.visible=!1}}function we(e){return 5-e%20*5}!function(e){e[e.SegmentHidden=0]="SegmentHidden",e[e.MIN=0]="MIN",e[e.PlaneLeft=1]="PlaneLeft",e[e.PlaneRight=2]="PlaneRight",e[e.PlaneFront=3]="PlaneFront",e[e.PlaneTop=4]="PlaneTop",e[e.PlaneBottom=5]="PlaneBottom",e[e.PlaneHidden=6]="PlaneHidden",e[e.MAX=6]="MAX"}(je||(je={}));var _e=function(e){var r=0,t=0,n=ne((function(e){return e.analysis}));Me.color=ne().theme.bass.wireframeColor,ve.color=ne().theme.bass.panelColor,Object(o.useEffect)((function(){return ne.subscribe((function(e){return e.theme.bass.wireframeColor}),(function(e){Me.color=e}))}),[]),Object(o.useEffect)((function(){return ne.subscribe((function(e){return e.theme.bass.panelColor}),(function(e){ve.color=e}))}),[]);var a=Object(o.useRef)([]),i=Object(o.useRef)([]),s=Object(o.useRef)([]),c=Object(o.useMemo)((function(){return he(40).map((function(e){return Object(ie.jsxs)("group",{ref:function(r){return a.current[e]=r},children:[Object(ie.jsx)("lineSegments",{ref:function(r){return i.current[e]=r},scale:[2,pe,5],geometry:me,material:Me}),Object(ie.jsx)("mesh",{ref:function(r){return s.current[e]=r},geometry:ye,material:ve})]},e)}))}),[]),l=Object(o.useMemo)((function(){return.5*n.secondsPerMeasure*20}),[n]);return Object(o.useEffect)((function(){for(var e=0;e<a.current.length;e++){var r=a.current[e],t=s.current[e],o=we(e);e<20?r.position.set(-12,0,o):r.position.set(12,0,o),ge(e,r,t,n,0)}}),[n,a,s]),Object(o.useEffect)((function(){return ne.subscribe((function(e){return[e.analysis,e.audioLastSeeked]}),(function(){r=0,t=0}))}),[]),Object(de.b)((function(){var o=we(0)+10,i=0,c=0,u=0,f=0;null!==e.audio.current&&(i=(c=e.audio.current.currentTime)%l*100/l);for(var d=r;d<n.bass.length;d++){var h=n.bass[d],b=h.time-.25,p=h.end+.5,m=h.intensity;if(b>c)break;p<c?r++:(c<h.time?m=L.MathUtils.mapLinear(c,b,h.time,0,m):c>h.end&&(m=L.MathUtils.mapLinear(c,h.end,p,m,0)),u=Math.max(m,u))}for(var j=t;j<n.subBass.length;j++){var M=n.subBass[j],y=M.time-.5,v=M.end+1.5,g=M.intensity;if(y>c)break;v<c?t++:(c<M.time?g=L.MathUtils.mapLinear(c,y,M.time,0,g):c>M.end&&(g=L.MathUtils.mapLinear(c,M.end,v,g,0)),f=Math.max(g,f))}for(var w=0;w<a.current.length;w++){var _=a.current[w],C=we(w)+i;if(_.visible=!n.isEmpty,C>o)if((C-=100)<_.position.z)ge(w,_,s.current[w],n,c);_.position.z=C,_.scale.set(1+f,1+.75*u,1)}})),Object(ie.jsx)("group",{children:c})};function Ce(e,r,t){var n=e%r/r*2*Math.PI;return Math.ceil(e/r)%2===0&&(n+=Math.PI/r),new L.Vector3(Math.cos(n),Math.sin(n),0).multiplyScalar(t)}var Oe=new L.SphereGeometry,xe=new L.MeshPhongMaterial({shininess:.5});var ke=function(e){var r=0,t=0,n=Object(o.useRef)([]),a=ne((function(e){return e.analysis}));xe.color=ne().theme.beat.color,Object(o.useEffect)((function(){return ne.subscribe((function(e){return e.theme.beat.color}),(function(e){xe.color=e}))}),[]);var i=he(36).map((function(e){return Object(ie.jsx)("mesh",{ref:function(r){return n.current[e]=r},visible:!1,position:Ce(e,6,5),geometry:Oe,material:xe},e)}));return Object(o.useEffect)((function(){return ne.subscribe((function(e){return[e.analysis,e.audioLastSeeked]}),(function(){r=0,t=0}))}),[]),Object(de.b)((function(o,i){if(null!==e.audio.current){for(var s=e.audio.current.currentTime,c=Math.max(s-i,0),l=r;l<a.beat.length;l++){var u=a.beat[l],f=u.time-1.5;if(c>u.end+.25)r++;else{if(f>s)break;n.current[t].userData.peak=u,t=(t+1)%n.current.length,r++}}var h,b=Object(d.a)(n.current);try{for(b.s();!(h=b.n()).done;){var p=h.value,m=p.userData.peak;if(null!==m&&void 0!==m){var j=m.time-1.5,M=m.end+.25;j>s||M<c?(p.visible=!1,delete p.userData.peak):(p.visible=!0,p.position.z=L.MathUtils.mapLinear(s,j,M,-200,-10),s>=m.time&&s<M?p.scale.setScalar(L.MathUtils.mapLinear(s,m.time,M,1,2)):p.scale.setScalar(1))}else p.visible=!1}}catch(y){b.e(y)}finally{b.f()}}})),Object(ie.jsx)("group",{children:i})},Fe=new L.LineBasicMaterial;var Se=function(e){var r=-20,t=ne((function(e){return e.analysis}));Fe.color=ne().theme.frequencyGrid.lineColor,Object(o.useEffect)((function(){return ne.subscribe((function(e){return e.theme.frequencyGrid.lineColor}),(function(e){Fe.color=e}))}),[]);var n=Object(o.useMemo)((function(){for(var e=[],r=-24,t=0;t<8;t++)e.push(new L.Vector3(r,0,0)),r+=1;for(var n=0;n<64;n++)e.push(new L.Vector3(r,0,0)),r+=.5;for(var o=0;o<8;o++)e.push(new L.Vector3(r,0,0)),r+=1;return e}),[]),a=Object(o.useMemo)((function(){var e=new L.BufferGeometry;return e.setFromPoints(n),e}),[n]),i=Object(o.useRef)([]),s=Object(o.useMemo)((function(){return he(10).map((function(e){var t=new L.Line(a,Fe);return t.position.set(0,-10,r*e-10),t.scale.set(.6,L.MathUtils.mapLinear(e,0,9,1,.1),1),i.current[e]=t,Object(ie.jsx)("primitive",{object:t},e)}))}),[a,-10,r,10]);return Object(de.b)((function(o,a){if(null!==e.analyser.current&&null!==e.audio.current){var s=new Uint8Array(e.analyser.current.frequencyBinCount);e.analyser.current.getByteFrequencyData(s);for(var c=0;c<s.length;c++)n[c+8].y=s[c]/255*5;for(var l=s[0]/255*5,u=s[s.length-1]/255*5,f=7;f>0;f--)l/=1.618,n[f].y=l;for(var d=72;d<n.length-1;d++)u/=1.618,n[d].y=u;var h=0,b=t.secondsPerMeasure;e.audio.current.currentTime>0&&(h=e.audio.current.currentTime%b/b);for(var p=0;p<i.current.length;p++){var m=i.current[p],j=r*p-10;m.visible=!t.isEmpty,m.geometry.setFromPoints(n),m.geometry.computeBoundingBox(),e.audio.current.currentTime>0?m.position.z=j-r*h:m.position.z=j}}})),Object(ie.jsx)("group",{children:s})},Ae=t(68);var Be=function(e){var r=0,t=0,n=Object(o.useRef)([]),a=ne((function(e){return e.analysis})),i=ne((function(e){return e.theme.treble})),s=Object(Ae.a)(i.spriteTexture),c=he(20).map((function(e){return Object(ie.jsxs)("group",{visible:!1,ref:function(r){return n.current[e]=r},children:[Object(ie.jsx)("sprite",{scale:[15,15,1],children:Object(ie.jsx)("spriteMaterial",{color:i.spriteColor,map:s,depthWrite:!1,transparent:!0,blending:L.CustomBlending,blendEquation:L.AddEquation,blendSrc:L.SrcAlphaFactor,blendDst:L.OneFactor})}),Object(ie.jsx)("pointLight",{color:i.lightColor,castShadow:!1,distance:20})]},e)}));return Object(o.useEffect)((function(){return ne.subscribe((function(e){return[e.analysis,e.audioLastSeeked]}),(function(){r=0,t=0}))}),[]),Object(de.b)((function(o,i){if(null!==e.audio.current){for(var s=e.audio.current.currentTime,c=Math.max(s-i,0),l=r;l<a.treble.length;l++){var u=a.treble[l],f=u.time-.1;if(c>u.end+.5)r++;else{if(f>s)break;var d=n.current[t];d.userData.peak=u;var h=a.getTrackSeededRandomInt(0,359,u.time)*L.MathUtils.DEG2RAD,b=a.getTrackSeededRandomInt(12,20,u.time);d.position.x=Math.cos(h)*b,d.position.y=Math.sin(h)*b,t=(t+1)%n.current.length,r++}}for(var p=0;p<n.current.length;p++){var m=n.current[p],j=m.userData.peak;if(null!==j&&void 0!==j){var M=j.time-.1,y=j.end+.5;if(M>s||y<c)m.visible=!1,delete m.userData.peak;else{m.visible=!0,m.position.z=L.MathUtils.mapLinear(s,M,y,-200,10);var v=m.children[0],g=m.children[1];if(s<j.time){var w=L.MathUtils.mapLinear(s,M,j.time,0,1);v.material.opacity=w,g.intensity=20*w}else if(s>j.end){var _=L.MathUtils.mapLinear(s,j.end,y,1,0);v.material.opacity=_,g.intensity=20*_}else v.material.opacity=1,g.intensity=20}}else m.visible=!1}}})),Object(ie.jsx)("group",{children:c})},Le=2*Math.PI;function Te(e,r,t){for(var n=[],o=Math.max(r-e,1),a=0;a<120;a++){var i=(3*a+t)*L.MathUtils.DEG2RAD,s=e+(Math.sin(a*e)+1)*o/2,c=Math.cos(i),l=Math.sin(i);n.push(new L.Vector3(c*e,l*e,0)),n.push(new L.Vector3(c*s,l*s,0))}var u=new L.BufferGeometry;return u.setFromPoints(n),u}var Ee=new L.PlaneGeometry(2048,2048);var Pe=function(e){var r=Object(Ae.a)({star_first:"/edenator/backgrounds/star-01.png",star_first_glow:"/edenator/backgrounds/star-01-glow.png",star_second:"/edenator/backgrounds/star-02.png",star_second_glow:"/edenator/backgrounds/star-02-glow.png",star_third:"/edenator/backgrounds/star-03.png",star_third_glow:"/edenator/backgrounds/star-03-glow.png",horizon:"/edenator/backgrounds/horizon.png"});[r.star_first,r.star_first_glow,r.star_second,r.star_second_glow,r.star_third,r.star_third_glow].forEach((function(e){e.wrapS=e.wrapT=L.RepeatWrapping,e.repeat.setScalar(4)})),r.horizon.wrapS=r.horizon.wrapT=L.RepeatWrapping;var t=ne((function(e){return e.analysis})),n=ne((function(e){return e.theme.background})),a=Object(o.useMemo)((function(){return Te(100,120,0)}),[]),i=Object(o.useMemo)((function(){return Te(125,145,15)}),[]),s=Object(o.useMemo)((function(){return Te(150,170,30)}),[]),c=Object(o.useMemo)((function(){return 8*t.secondsPerMeasure}),[t]),l=Object(o.useMemo)((function(){return 16*t.secondsPerMeasure}),[t]),u=Object(o.useRef)(null),f=Object(o.useRef)(null),d=Object(o.useRef)(null),h=Object(o.useRef)(null),b=Object(o.useRef)(null),p=Object(o.useRef)(null),m=Object(o.useRef)(null),j=Object(o.useRef)(null),M=Object(o.useRef)(null),y=Object(o.useRef)(null),v=Object(o.useRef)(null);return Object(de.b)((function(r){r.scene.background=n.fillColor,j.current.visible=!t.isEmpty;var o=0,a=0;null!==e.audio.current&&(o=e.audio.current.currentTime,a=e.audio.current.duration);var i=o%c/c,s=Math.sin(i*Le);M.current.rotation.set(0,0,s),y.current.rotation.set(0,0,.75*s),v.current.rotation.set(0,0,.5*s);var g=o%l/l,w=Math.sin(g*Le);f.current.position.x=50*w,d.current.position.x=50*w,h.current.position.x=60*w,b.current.position.x=60*w,p.current.position.x=70*w,m.current.position.x=70*w;var _=0,C=0,O=0,x=0;if(o>0&&null!==e.analyser.current){var k=new Uint8Array(e.analyser.current.frequencyBinCount);e.analyser.current.getByteFrequencyData(k),Number.isFinite(k[15])&&(_=k[15]/255/2),Number.isFinite(k[7])&&(C=k[7]/255/4),Number.isFinite(k[31])&&(O=k[31]/255/3),Number.isFinite(k[53])&&(x=k[53]/255/5)}M.current.material.opacity=.5+_,y.current.material.opacity=.4+_,v.current.material.opacity=.3+_;var F=.95*u.current.material.opacity;F<=.01&&(F=0),u.current.material.opacity=Math.max(O,F);var S=.95*d.current.material.opacity;S<=.01&&(S=0);var A=Math.max(x,S);d.current.material.opacity=A,b.current.material.opacity=A,m.current.material.opacity=A;var B=.9*M.current.scale.x,T=Math.max(1+C,B);if(M.current.scale.x=M.current.scale.y=T,y.current.scale.x=y.current.scale.y=T,v.current.scale.x=v.current.scale.y=T,Number.isFinite(a)&&a>0){var E=L.MathUtils.mapLinear(o,0,a,.5,1.5);j.current.scale.x=j.current.scale.y=E}})),Object(ie.jsxs)("group",{children:[Object(ie.jsxs)("mesh",{ref:u,frustumCulled:!1,position:[0,0,-300],scale:[8,.125,1],children:[Object(ie.jsx)("planeGeometry",{args:[1024,512]}),Object(ie.jsx)("meshBasicMaterial",{color:n.starFlashColor,map:r.horizon,transparent:!0,opacity:0,fog:!1,depthWrite:!1,precision:"mediump"})]}),Object(ie.jsxs)("group",{ref:j,children:[Object(ie.jsx)("lineSegments",{ref:M,position:[0,0,-250],geometry:a,children:Object(ie.jsx)("lineBasicMaterial",{color:n.burstLineColor,transparent:!0,opacity:.5,fog:!1,precision:"lowp"})}),Object(ie.jsx)("lineSegments",{ref:y,position:[0,0,-250],geometry:i,children:Object(ie.jsx)("lineBasicMaterial",{color:n.burstLineColor,transparent:!0,opacity:.4,fog:!1,precision:"lowp"})}),Object(ie.jsx)("lineSegments",{ref:v,position:[0,0,-250],geometry:s,children:Object(ie.jsx)("lineBasicMaterial",{color:n.burstLineColor,transparent:!0,opacity:.3,fog:!1,precision:"lowp"})})]}),Object(ie.jsxs)("group",{children:[Object(ie.jsx)("mesh",{ref:d,position:[0,0,-599],scale:[2,2,1],frustumCulled:!1,geometry:Ee,children:Object(ie.jsx)("meshBasicMaterial",{color:n.starFlashColor,map:r.star_first_glow,transparent:!0,opacity:0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(ie.jsx)("mesh",{ref:f,position:[0,0,-600],scale:[2,2,1],frustumCulled:!1,geometry:Ee,children:Object(ie.jsx)("meshBasicMaterial",{color:n.starColor,map:r.star_first,transparent:!0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(ie.jsx)("mesh",{ref:b,position:[0,0,-699],scale:[2,2,1],frustumCulled:!1,geometry:Ee,children:Object(ie.jsx)("meshBasicMaterial",{color:n.starFlashColor,map:r.star_second_glow,transparent:!0,opacity:0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(ie.jsx)("mesh",{ref:h,position:[0,0,-700],scale:[2,2,1],frustumCulled:!1,geometry:Ee,children:Object(ie.jsx)("meshBasicMaterial",{color:n.starColor,map:r.star_second,transparent:!0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(ie.jsx)("mesh",{ref:m,position:[0,0,-799],scale:[2,2,1],frustumCulled:!1,geometry:Ee,children:Object(ie.jsx)("meshBasicMaterial",{color:n.starFlashColor,map:r.star_third_glow,transparent:!0,opacity:0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(ie.jsx)("mesh",{ref:p,position:[0,0,-800],scale:[2,2,1],frustumCulled:!1,geometry:Ee,children:Object(ie.jsx)("meshBasicMaterial",{color:n.starColor,map:r.star_third,transparent:!0,fog:!1,depthWrite:!1,precision:"lowp"})})]})]})},Re=t(35),De=t(10);var Ge=function(e){var r=Object(o.useRef)(null);return Object(de.b)((function(){if(!(null===e.audio.current||e.audio.current.currentTime<=0||null===e.analyser.current||null===r.current)){var t=new Uint8Array(e.analyser.current.frequencyBinCount);e.analyser.current.getByteFrequencyData(t);var n=r.current.godRaysPass.getFullscreenMaterial();if(Number.isFinite(t[5])){var o=t[5]/255;n.uniforms.decay.value=L.MathUtils.lerp(.4,.93,o),n.uniforms.exposure.value=L.MathUtils.lerp(.4,.85,o)}else n.uniforms.decay.value=.4,n.uniforms.exposure.value=.4}})),Object(ie.jsxs)(Re.b,{children:[Object(ie.jsx)(Re.a,{intensity:1,width:De.y.AUTO_SIZE,height:De.y.AUTO_SIZE,kernelSize:De.r.MEDIUM,luminanceThreshold:.4,luminanceSmoothing:.1}),Object(ie.jsx)(Re.c,{ref:r,sun:e.sunMesh,blur:10,blendFunction:De.a.Screen,samples:60,density:.85,decay:.85,weight:.4,exposure:.4,clampMax:1,width:De.y.AUTO_SIZE,height:De.y.AUTO_SIZE,kernelSize:De.r.MEDIUM})]})},qe=new L.MeshBasicMaterial({transparent:!0,fog:!1}),Ue=new L.Mesh(new L.SphereGeometry(5),qe);Ue.frustumCulled=!1,Ue.position.set(0,0,-200);var Ve=function(e){return qe.color=ne.getState().theme.background.sunColor,Object(o.useEffect)((function(){return ne.subscribe((function(e){return e.theme.background.sunColor}),(function(e){qe.color=e}))}),[]),Object(ie.jsxs)(de.a,{camera:{position:[0,0,15]},children:[Object(ie.jsx)("ambientLight",{intensity:.1}),Object(ie.jsx)("directionalLight",{position:[0,0,20]}),Object(ie.jsx)("primitive",{object:Ue}),Object(ie.jsx)(_e,{audio:e.audio}),Object(ie.jsx)(ke,{audio:e.audio}),Object(ie.jsx)(Se,{audio:e.audio,analyser:e.analyser}),Object(ie.jsx)(Be,{audio:e.audio}),Object(ie.jsx)(Pe,{audio:e.audio,analyser:e.analyser}),Object(ie.jsx)(Ge,{audio:e.audio,analyser:e.analyser,sunMesh:Ue})]})};t(66);function Ie(){return navigator.userAgent.indexOf("AppleWebKit")>-1&&-1===navigator.userAgent.indexOf("Chrome")}var Ne=function(){var e="",r=ne((function(e){return e.setAnalysis})),t=ne((function(e){return e.setTheme})),a=ne((function(e){return e.indicateAudioSeeked})),i=Object(o.useRef)(new AudioContext),s=Object(o.useRef)(null),l=Object(o.useRef)(null),u=Object(o.useRef)(null),f=Object(o.useState)(""),d=Object(c.a)(f,2),h=d[0],b=d[1],p=Object(o.useRef)(null),m=Object(o.useRef)(null),j=Object(o.useRef)(new WeakMap),M=Object(o.useCallback)((function(e){if(null!=e){var r;j.current.has(e)?r=j.current.get(e):(r=new MediaElementAudioSourceNode(i.current,{mediaElement:e}),j.current.set(e,r));var t=new AnalyserNode(i.current,{fftSize:128});r.connect(t),t.connect(i.current.destination),p.current=e,m.current=t}}),[i]);return Object(o.useEffect)((function(){return ne.subscribe((function(e){return e.analysis}),(function(e){null===e||e.isEmpty||""===e.artist||""===e.title?document.title="Edenator":document.title="Edenator (".concat(e.artist," - ").concat(e.title,")")}))}),[]),Object(ie.jsxs)("div",{children:[Object(ie.jsx)(fe,{}),Object(ie.jsxs)("div",{ref:s,className:"app-title",children:[Object(ie.jsx)("h1",{children:"Edenator"}),Object(ie.jsx)("p",{children:"An in-browser audio visualizer. Start by choosing a track."}),Object(ie.jsx)("p",{children:Object(ie.jsx)("strong",{children:Object(ie.jsx)("em",{children:"The visuals used by this application may not be suitable for people with photosensitive epilepsy."})})}),Object(ie.jsx)("p",{children:"This visualizer requires support for WebGL 2.0 and the Web Audio API. All audio processing is performed in-browser and is not uploaded."})]}),Object(ie.jsxs)("div",{className:"app-error",hidden:!h,children:[h,Object(ie.jsx)("button",{type:"button",onClick:function(){return b("")},children:"Dismiss"})]}),Object(ie.jsxs)("div",{id:"filePicker",children:[Object(ie.jsx)("button",{type:"button",ref:u,id:"dummyFilePicker",className:"btn",onClick:function(){if(Ie()&&i.current&&p.current&&!p.current.src)try{i.current.resume(),p.current.play()}catch(e){}l.current.click()},children:"Choose a track"}),Object(ie.jsx)("input",{type:"file",ref:l,id:"sourceFile","aria-label":"Choose an audio file",accept:Ie()?".mp3,.m4a,.ogg,.aac,.flac":"audio/*",onChange:function(){var o,c;if(1===(null===(o=l.current)||void 0===o||null===(c=o.files)||void 0===c?void 0:c.length)){u.current.disabled=!0,u.current.innerText="Analyzing...",l.current.disabled=!0,l.current.readOnly=!0,b(""),p.current&&(p.current.pause(),p.current.controls=!1);var f=l.current.files[0];(function(e){return F.apply(this,arguments)})(f).then((function(o){var c=URL.createObjectURL(f);if(null!==p.current){p.current.src=c,p.current.load();var l=i.current.resume(),u=p.current.play();void 0!==l&&void 0!==u&&Promise.all([l,u]).then((function(){})).catch((function(){window.setTimeout((function(){i.current&&p.current&&(i.current.resume(),p.current.play())}))}))}""!==e&&URL.revokeObjectURL(e),e=c,s.current.hidden=!0,r(o),t(function(e){if(null===e)return q;if(null===e.key){var r=e.getTrackRandomInt(0,re.length-1);return re[r]}switch(e.key){case n.C_Major:case n.A_Minor:return U;case n.G_Major:case n.E_Minor:return V;case n.D_Major:case n.B_Minor:return I;case n.A_Major:case n.F_Sharp_Minor:return N;case n.E_Major:case n.C_Sharp_Minor:return z;case n.B_Major:case n.G_Sharp_Minor:return W;case n.F_Sharp_Major:case n.D_Sharp_Minor:return X;case n.D_Flat_Major:case n.B_Flat_Minor:return H;case n.A_Flat_Major:case n.F_Minor:return K;case n.E_Flat_Major:case n.C_Minor:return Z;case n.B_Flat_Major:case n.G_Minor:return Y;case n.F_Major:case n.D_Minor:return J;case n.OffKey:return Q;default:return q}}(o)),a()})).catch((function(e){console.error(e),b('Error opening "'.concat(null===f||void 0===f?void 0:f.name,'":\n').concat(e.toString()))})).finally((function(){l.current&&(l.current.disabled=!1,l.current.readOnly=!1),u.current&&(u.current.disabled=!1,u.current.innerText="Choose a track"),p.current&&p.current.src&&(p.current.controls=!0)}))}}})]}),Object(ie.jsx)("button",{type:"button",id:"themeCycler",className:"btn",onClick:function(){var e=function(e){var r=re.indexOf(e);return-1===r||r===re.length-1?re[0]:re[r+1]}(ne.getState().theme);t(e)},children:"Switch theme"}),Object(ie.jsx)("audio",{ref:M,id:"audioPlayer",onSeeked:a}),Object(ie.jsx)("div",{id:"canvas-container",children:Object(ie.jsx)(o.Suspense,{fallback:null,children:Object(ie.jsx)(Ve,{audio:p,analyser:m})})}),!1,!1]})},ze=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,69)).then((function(r){var t=r.getCLS,n=r.getFID,o=r.getFCP,a=r.getLCP,i=r.getTTFB;t(e),n(e),o(e),a(e),i(e)}))};s.a.render(Object(ie.jsx)(a.a.StrictMode,{children:Object(ie.jsx)(Ne,{})}),document.getElementById("root")),ze()}},[[67,1,2]]]);
//# sourceMappingURL=main.42d95ca0.chunk.js.map