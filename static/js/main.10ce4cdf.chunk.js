(this.webpackJsonpedenator=this.webpackJsonpedenator||[]).push([[0],{54:function(e,r,t){},61:function(e,r,t){},66:function(e,r,t){"use strict";t.r(r);var n,a=t(5),o=t.n(a),i=t(41),s=t.n(i),c=(t(54),t(13)),l=t(16),u=t.n(l),d=t(20),f=t(11),h=t(42),b=t(1),p=t(2);!function(e){e.C_Major="1d",e.A_Minor="1m",e.G_Major="2d",e.E_Minor="2m",e.D_Major="3d",e.B_Minor="3m",e.A_Major="4d",e.F_Sharp_Minor="4m",e.E_Major="5d",e.C_Sharp_Minor="5m",e.B_Major="6m",e.G_Sharp_Minor="6d",e.F_Sharp_Major="7d",e.D_Sharp_Minor="7m",e.D_Flat_Major="8d",e.B_Flat_Minor="8m",e.A_Flat_Major="9d",e.F_Minor="9m",e.E_Flat_Major="10d",e.C_Minor="10m",e.B_Flat_Major="11d",e.G_Minor="11m",e.F_Major="12d",e.D_Minor="12m",e.OffKey="0"}(n||(n={}));var m=function(){function e(){Object(b.a)(this,e),this.title="",this.artist="",this.bpm=120,this.length=0,this.key=null,this.subBass=[],this.bass=[],this.beat=[],this.treble=[],this.trackHash=1,this.isEmpty=!1}return Object(p.a)(e,[{key:"secondsPerMeasure",get:function(){return 240/this.bpm}},{key:"getTrackRandomInt",value:function(e,r){return this.getTrackSeededRandomInt(e,r,0)}},{key:"getTrackSeededRandomInt",value:function(e,r,t){var n=(Math.sin(this.trackHash+t)+1)/2;return e+Math.floor(n*(r-e+1))}},{key:"getTrackSeededRandomFloat",value:function(e,r,t){return e+(Math.sin(this.trackHash+t)+1)/2*(r-e)}}]),e}(),j=new m;j.isEmpty=!0;var M=44100,y=Object.values(n),v={"1A":n.G_Sharp_Minor,"G#m":n.G_Sharp_Minor,Abm:n.G_Sharp_Minor,"1B":n.B_Major,B:n.B_Major,"2A":n.D_Sharp_Minor,"D#m":n.D_Sharp_Minor,Ebm:n.D_Sharp_Minor,"2B":n.F_Sharp_Major,"F#":n.F_Sharp_Major,Gb:n.F_Sharp_Major,"3A":n.B_Flat_Minor,"A#m":n.B_Flat_Minor,Bbm:n.B_Flat_Minor,"3B":n.D_Flat_Major,"C#":n.D_Flat_Major,Db:n.D_Flat_Major,"4A":n.F_Minor,Fm:n.F_Minor,"4B":n.A_Flat_Major,"G#":n.A_Flat_Major,Ab:n.A_Flat_Major,"5A":n.C_Minor,Cm:n.C_Minor,"5B":n.E_Flat_Major,"D#":n.E_Flat_Major,Eb:n.E_Flat_Major,"6A":n.G_Minor,Gm:n.G_Minor,"6B":n.B_Flat_Major,"A#":n.B_Flat_Major,Bb:n.B_Flat_Major,"7A":n.D_Minor,Dm:n.D_Minor,"7B":n.F_Major,F:n.F_Major,"8A":n.A_Minor,Am:n.A_Minor,"8B":n.C_Major,C:n.C_Major,"9A":n.E_Minor,Em:n.E_Minor,"9B":n.G_Major,G:n.G_Major,"10A":n.B_Minor,Bm:n.B_Minor,"10B":n.D_Major,D:n.D_Major,"11A":n.F_Sharp_Minor,"F#m":n.F_Sharp_Minor,Gbm:n.F_Sharp_Minor,"11B":n.A_Major,A:n.A_Major,"12A":n.C_Sharp_Minor,"C#m":n.C_Sharp_Minor,Dbm:n.C_Sharp_Minor,"12B":n.E_Major,E:n.E_Major,o:n.OffKey,O:n.OffKey};function g(e){return new Promise((function(r,t){new h.Reader(e).read({onSuccess:function(e){r(e)},onError:function(e){var r=new Error(e.info);r.name="MediaTagsError",t(r)}})}))}function _(e,r,t){if(null!==r){var n,a=Object(f.a)(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o in e.tags)return e.tags[o]}}catch(b){a.e(b)}finally{a.f()}}if(null!==t&&"TXXX"in e.tags){var i=[];i=Array.isArray(e.tags.TXXX)?e.tags.TXXX:[e.tags.TXXX];var s,c=Object(f.a)(t);try{for(c.s();!(s=c.n()).done;){var l,u=s.value,d=Object(f.a)(i);try{for(d.s();!(l=d.n()).done;){var h=l.value;if("user_description"in h.data&&"data"in h.data&&h.data.user_description===u)return{id:u,description:u,data:h.data.data}}}catch(b){d.e(b)}finally{d.f()}}}catch(b){c.e(b)}finally{c.f()}}return null}function w(e){var r=_(e,["BPM","TBPM","TMPO"],["fBPM"]),t="";return null===r?null:("string"===typeof(t=r.data)&&(t=parseFloat(t)),"number"===typeof t&&Number.isFinite(t)&&t>0?t:null)}function O(e){var r=_(e,["KEY","TKEY"],["INITIAL KEY","INITIAL_KEY"]),t="";return null===r?null:((t=(t=r.data.toString()).replace(/ /,""))in v&&(t=v[t]),null!==t&&y.includes(t.trim())?t:null)}function C(e){return new window.OfflineAudioContext(1,M,M).decodeAudioData(e).then((function(e){var r=new window.OfflineAudioContext(1,e.length,M),t=r.createBufferSource();return t.buffer=e,t.connect(r.destination),t.start(0),r.startRendering()})).then((function(e){for(var r=e.getChannelData(0),t=new Float32Array(r),n=Math.floor(882),a=0,o=0;o<r.length;o+=n){var i,s=0,c=0;for(c=0;c<n&&o+c<r.length;c++)s+=r[o+c]*r[o+c];for(i=Math.sqrt(s/(c+1)),a=Math.max(i,.9*a),c=0;c<n&&o+c<r.length;c++)t[o+c]=a}return t}))}function x(e,r,t){var n=new window.OfflineAudioContext(1,r.length,M);return n.decodeAudioData(e).then((function(e){var r=n.createBufferSource(),a=r;if(r.buffer=e,null!=t.minFrequency){var o=new BiquadFilterNode(n,{type:"highpass",Q:1,frequency:t.minFrequency});a.connect(o),a=o}if(null!=t.maxFrequency){var i=new BiquadFilterNode(n,{type:"lowpass",Q:1,frequency:t.maxFrequency});a.connect(i),a=i}return a.connect(n.destination),r.start(0),n.startRendering()})).then((function(e){for(var n=e.getChannelData(0),a=[],o={},i=0;i<n.length;)if(0!==r[i]){var s=Math.abs(n[i]),c=s/r[i];if(s>=t.initialAbsoluteThreshold&&c>=t.initialRelativeThreshold){var l={time:i/M,intensity:0,intensityNormalized:0,end:0};do{if(l.intensity=Math.max(l.intensity,s),l.intensityNormalized=Math.max(l.intensityNormalized,c),++i>=n.length||0===r[i])break;c=(s=Math.abs(n[i]))/r[i]}while(s>=t.sustainAbsoluteThreshold&&c>=t.sustainRelativeThreshold);l.end=i/M,a.push(l);var u=l.intensityNormalized.toFixed(2);u in o?o[u]++:o[u]=1,i+=Math.ceil(2756.25)}i++}else i++;var d=Math.ceil(t.expectedMaxPeaksPerMinute*e.duration/60);if(a.length>d){for(var f=Object.keys(o).map((function(e){return{intensity:parseFloat(e),count:o[e]}})).sort((function(e,r){return r.intensity-e.intensity})),h=0,b=f[0].intensity,p=f[0].count;p<d&&h<f.length-1;)h++,b=f[h].intensity,p+=f[h].count;return a.filter((function(e){return e.intensityNormalized>=b}))}return a}))}function k(e,r){if(!e)return null;var t=r/60*45;if(e.length<t)return null;var n={};e.forEach((function(r,t){for(var a=1;a<10&&!(t+a>=e.length);a++){var o=e[t+a].time-r.time,i=o.toFixed(2);o<.25||(i in n?n[i]++:n[i]=1)}}));var a={};Object.keys(n).forEach((function(e){for(var r=60/(parseFloat(e)/M);r<90;)r*=2;for(;r>180;)r/=2;var t=r.toFixed(0);t in a?a[t]+=n[e]:a[t]=n[e]}));var o=Object.keys(a).map((function(e){return{bpm:parseFloat(e),intervals:a[e]}})).sort((function(e,r){return r.bpm-e.bpm})),i=0,s=0,c=0;o.forEach((function(e){e.intervals>i&&(e.bpm,i=e.intervals),s+=e.bpm*e.intervals,c+=e.intervals}));var l=s/c;if(c>2&&o.length>1){for(var u=Math.floor(c/2),d=0;u>0&&d<o.length;)u-=o[d].intervals,d++;0===u?(o[d-1].bpm+o[d].bpm)/2:o[d-1].bpm}return l}function F(){return(F=Object(d.a)(u.a.mark((function e(r){var t,n,a,o,i,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g(r);case 3:t=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 9:return e.next=11,r.arrayBuffer().then((function(e){return C(e)}));case 11:return n=e.sent,a=r.arrayBuffer().then((function(e){return x(e,n,{minFrequency:20,maxFrequency:50,expectedMaxPeaksPerMinute:60,initialAbsoluteThreshold:.4,initialRelativeThreshold:.5,sustainAbsoluteThreshold:.4,sustainRelativeThreshold:.5})})),o=r.arrayBuffer().then((function(e){return x(e,n,{minFrequency:50,maxFrequency:90,expectedMaxPeaksPerMinute:120,initialAbsoluteThreshold:.4,initialRelativeThreshold:.5,sustainAbsoluteThreshold:.4,sustainRelativeThreshold:.5})})),i=r.arrayBuffer().then((function(e){return x(e,n,{minFrequency:90,maxFrequency:200,expectedMaxPeaksPerMinute:300,initialAbsoluteThreshold:.4,initialRelativeThreshold:.5,sustainAbsoluteThreshold:.4,sustainRelativeThreshold:.5})})),s=r.arrayBuffer().then((function(e){return x(e,n,{minFrequency:2048,maxFrequency:null,expectedMaxPeaksPerMinute:120,initialAbsoluteThreshold:.4,initialRelativeThreshold:.5,sustainAbsoluteThreshold:.25,sustainRelativeThreshold:.35})})),e.abrupt("return",Promise.all([t,a,o,i,s]).then((function(e){var t,a,o,i=Object(c.a)(e,5),s=i[0],l=i[1],u=i[2],d=i[3],f=i[4],h=n.length/M,b=O(s),p=w(s);p||(p=k(d,h));var j=new m;return j.title=null!==(t=s.tags.title)&&void 0!==t?t:"Unknown Title",j.artist=null!==(a=s.tags.artist)&&void 0!==a?a:"Unknown Artist",j.bpm=null!==(o=p)&&void 0!==o?o:120,j.length=h,j.key=b,j.subBass=l,j.bass=u,j.beat=d,j.treble=f,j.trackHash=Math.floor(r.lastModified+r.size)+1,j})));case 17:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var S=t(31),B=t.n(S),A=t(43),L=t(0),T=new L.Color(0),P=new L.Color(16777215);function E(e){return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function R(e){return.2126*E(e.r)+.7152*E(e.g)+.0722*E(e.b)}function D(e,r,t){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null===n&&(n=new L.Color(r).lerp(t,.5));var a,o,i,s=.43;return R(r)<s?(a=P,o=new L.Color(r).lerp(T,.3),i=new L.Color(r).lerp(P,.2)):(a=T,o=new L.Color(r).lerp(P,.3),i=new L.Color(r).lerp(T,.2)),{name:e,bass:{wireframeColor:new L.Color(n).lerp(T,.3),panelColor:new L.Color(n)},beat:{color:new L.Color(r)},treble:{spriteColor:new L.Color(r).lerp(P,.65),spriteTexture:"/edenator/textures/extendring.png",lightColor:new L.Color(r).lerp(P,.75)},frequencyGrid:{lineColor:new L.Color(t)},background:{fillColor:new L.Color(r).lerp(T,.97),sunColor:new L.Color(r).lerp(t,.75).lerp(P,.5),burstLineColor:new L.Color(r).lerp(t,.75).lerp(P,.25),starColor:new L.Color(r).lerp(t,.75).lerp(P,.1),starFlashColor:new L.Color(r).lerp(t,.75)},ui:{textColor:a,backgroundColor:new L.Color(r),disabledBackgroundColor:o,focusBackgroundColor:i,borderColor:new L.Color(t)}}}var G=D("default",new L.Color(15418624),new L.Color(16125452),new L.Color(16160268)),V=D("magenta",new L.Color("Orchid"),new L.Color("DarkOrchid")),q=D("indigo",new L.Color("BlueViolet"),new L.Color("DarkViolet")),U=D("light blue",new L.Color("LightBlue"),new L.Color("CornflowerBlue")),I=D("mid blue",new L.Color("DeepSkyBlue"),new L.Color("LightSkyBlue")),N=D("deep blue",new L.Color("DodgerBlue"),new L.Color("SteelBlue")),z=D("blue-green",new L.Color("Teal"),new L.Color("MediumTurquoise")),X=D("green",new L.Color("LimeGreen"),new L.Color("MediumSeaGreen")),W=D("yellow-green",new L.Color("GreenYellow"),new L.Color("YellowGreen")),H=D("yellow",new L.Color("Gold"),new L.Color("Yellow")),K=D("orange",new L.Color("OrangeRed"),new L.Color("Tomato")),Y=D("red",new L.Color("Red"),new L.Color("Coral")),Z=D("pink",new L.Color("HotPink"),new L.Color("PaleVioletRed")),J=D("hotdog stand",new L.Color(16711680),new L.Color(16776960)),Q=D("fluorescent",new L.Color(16711935),new L.Color(65280)),$=D("plasma power saver",new L.Color(255),new L.Color(16711935),new L.Color(11337810)),ee=[G,V,q,U,I,N,z,X,W,H,K,Y,Z,J,Q,$];var re,te=B()(Object(A.subscribeWithSelector)((function(e){return{analysis:j,theme:G,audioLastSeeked:0,setAnalysis:function(r){return e((function(e){e.analysis=r}))},setTheme:function(r){return e((function(e){e.theme=r}))},indicateAudioSeeked:function(){return e((function(e){e.audioLastSeeked=Date.now()}))}}}))),ne=(t(61),t(44)),ae=t(45),oe=t(8),ie=new Path2D("M64,12.8C64,5.735 58.265,0 51.2,0L12.8,0C5.735,0 0,5.735 0,12.8L0,51.2C0,58.265 5.735,64 12.8,64L51.2,64C58.265,64 64,58.265 64,51.2L64,12.8Z"),se=new Path2D("M-0.063,32C-0.063,32 0.1,14.756 0.706,14.762C1.308,14.768 1.352,48.687 2.623,48.679C3.713,48.672 4.033,19.674 6.498,19.72C8.476,19.757 9.898,44.125 11.665,44.137C13.269,44.148 15.225,27.314 18.123,27.262C19.97,27.228 22.316,34.293 24.748,34.262C26.547,34.239 29.486,30.126 31.915,30.179C33.821,30.22 36.836,32.346 39.185,32.262C41.258,32.188 44.23,31.313 45.976,31.262C47.511,31.217 51.354,32.125 53.396,32.058C55.048,32.004 58.987,31.707 60.222,31.672C61.416,31.638 62.61,31.788 63.804,31.845"),ce=new Path2D("M25.418,10.25L27.74,9.882L27.993,11.48L29.435,10.745L30.502,12.84L29.06,13.575L30.204,14.719L28.542,16.381L27.398,15.237L26.663,16.679L24.568,15.612L25.303,14.17L23.705,13.917L24.073,11.595L25.671,11.848L25.418,10.25Z"),le=new Path2D("M44.075,49.242L45.903,47.762L46.921,49.02L47.802,47.663L49.774,48.943L48.893,50.3L50.456,50.719L49.847,52.99L48.284,52.571L48.369,54.187L46.021,54.31L45.936,52.694L44.426,53.274L43.583,51.079L45.094,50.499L44.075,49.242Z");var ue=function(){var e=te((function(e){return e.theme.ui}));return Object(a.useEffect)((function(){return te.subscribe((function(e){return e.theme.ui}),(function(e){var r;null===(r=document.querySelector('meta[name="theme-color"]'))||void 0===r||r.setAttribute("content",e.backgroundColor.getStyle());var t=document.createElement("canvas");t.setAttribute("width","64px"),t.setAttribute("height","64px");var n=t.getContext("2d",{alpha:!0,desynchronized:!0});if(n){var a;n.fillStyle=e.backgroundColor.getStyle(),n.fill(ie),n.strokeStyle=e.textColor.getStyle(),n.lineWidth=2,n.stroke(se),n.lineWidth=1,n.stroke(ce),n.stroke(le);var o=t.toDataURL("image/png");null===(a=document.querySelector('link[rel="icon"]'))||void 0===a||a.setAttribute("href",o)}t.remove()}))}),[]),Object(oe.jsx)("style",{type:"text/css",children:Object(ae.a)(re||(re=Object(ne.a)(["\n        html {\n          --ui-color-text: ",";\n          --ui-color-contrast: ",";\n          --ui-color-contrast-disabled: ",";\n          --ui-color-contrast-focus: ",";\n          --ui-color-border: ",";\n      }"])),e.textColor.getStyle(),e.backgroundColor.getStyle(),e.disabledBackgroundColor.getStyle(),e.focusBackgroundColor.getStyle(),e.borderColor.getStyle())})},de=t(15);function fe(e){return Array.from(Array(e).keys())}var he=Math.PI/2,be=15,pe=new L.BufferGeometry;pe.setFromPoints([new L.Vector3(.5,-.5,.5),new L.Vector3(.5,.5,.5),new L.Vector3(.5,.5,.5),new L.Vector3(-.5,.5,.5),new L.Vector3(-.5,.5,.5),new L.Vector3(-.5,-.5,.5),new L.Vector3(-.5,-.5,.5),new L.Vector3(.5,-.5,.5),new L.Vector3(-.5,.5,.5),new L.Vector3(-.5,.5,-.5),new L.Vector3(-.5,-.5,.5),new L.Vector3(-.5,-.5,-.5),new L.Vector3(.5,.5,.5),new L.Vector3(.5,.5,-.5),new L.Vector3(.5,-.5,.5),new L.Vector3(.5,-.5,-.5),new L.Vector3(.5,-.5,-.5),new L.Vector3(.5,.5,-.5),new L.Vector3(.5,.5,-.5),new L.Vector3(-.5,.5,-.5),new L.Vector3(-.5,.5,-.5),new L.Vector3(-.5,-.5,-.5),new L.Vector3(-.5,-.5,-.5),new L.Vector3(.5,-.5,-.5)]);var me,je=new L.LineBasicMaterial,Me=new L.PlaneGeometry,ye=new L.MeshBasicMaterial({side:L.DoubleSide,transparent:!0,opacity:.6});function ve(e,r,t,n,a){switch(r.visible=!0,t.visible=!0,n.isEmpty?me.PlaneHidden:n.getTrackSeededRandomInt(me.MIN,me.MAX,a+e)){case me.SegmentHidden:r.visible=!1,t.visible=!1;break;case me.PlaneLeft:t.scale.set(5,be,1),t.position.set(-1,0,0),t.rotation.set(0,he,0);break;case me.PlaneRight:t.scale.set(5,be,1),t.position.set(1,0,0),t.rotation.set(0,he,0);break;case me.PlaneFront:t.scale.set(2,be,1),t.position.set(0,0,2.5),t.rotation.set(0,0,0);break;case me.PlaneTop:t.scale.set(2,5,1),t.position.set(0,7.5,0),t.rotation.set(he,0,0);break;case me.PlaneBottom:t.scale.set(2,5,1),t.position.set(0,-7.5,0),t.rotation.set(he,0,0);break;case me.PlaneHidden:t.visible=!1;break;default:0,t.visible=!1}}function ge(e){return 5-e%20*5}!function(e){e[e.SegmentHidden=0]="SegmentHidden",e[e.MIN=0]="MIN",e[e.PlaneLeft=1]="PlaneLeft",e[e.PlaneRight=2]="PlaneRight",e[e.PlaneFront=3]="PlaneFront",e[e.PlaneTop=4]="PlaneTop",e[e.PlaneBottom=5]="PlaneBottom",e[e.PlaneHidden=6]="PlaneHidden",e[e.MAX=6]="MAX"}(me||(me={}));var _e=function(e){var r=0,t=0,n=te((function(e){return e.analysis}));je.color=te().theme.bass.wireframeColor,ye.color=te().theme.bass.panelColor,Object(a.useEffect)((function(){return te.subscribe((function(e){return e.theme.bass.wireframeColor}),(function(e){je.color=e}))}),[]),Object(a.useEffect)((function(){return te.subscribe((function(e){return e.theme.bass.panelColor}),(function(e){ye.color=e}))}),[]);var o=Object(a.useRef)([]),i=Object(a.useRef)([]),s=Object(a.useRef)([]),c=Object(a.useMemo)((function(){return fe(40).map((function(e){return Object(oe.jsxs)("group",{ref:function(r){return o.current[e]=r},children:[Object(oe.jsx)("lineSegments",{ref:function(r){return i.current[e]=r},scale:[2,be,5],geometry:pe,material:je}),Object(oe.jsx)("mesh",{ref:function(r){return s.current[e]=r},geometry:Me,material:ye})]},e)}))}),[]),l=Object(a.useMemo)((function(){return.5*n.secondsPerMeasure*20}),[n]);return Object(a.useEffect)((function(){for(var e=0;e<o.current.length;e++){var r=o.current[e],t=s.current[e],a=ge(e);e<20?r.position.set(-12,0,a):r.position.set(12,0,a),ve(e,r,t,n,0)}}),[n,o,s]),Object(a.useEffect)((function(){return te.subscribe((function(e){return[e.analysis,e.audioLastSeeked]}),(function(){r=0,t=0}))}),[]),Object(de.b)((function(){var a=ge(0)+10,i=0,c=0,u=0,d=0;null!==e.audio.current&&(i=(c=e.audio.current.currentTime)%l*100/l);for(var f=r;f<n.bass.length;f++){var h=n.bass[f],b=h.time-.25,p=h.end+.5,m=h.intensity;if(b>c)break;p<c?r++:(c<h.time?m=L.MathUtils.mapLinear(c,b,h.time,0,m):c>h.end&&(m=L.MathUtils.mapLinear(c,h.end,p,m,0)),u=Math.max(m,u))}for(var j=t;j<n.subBass.length;j++){var M=n.subBass[j],y=M.time-.5,v=M.end+1.5,g=M.intensity;if(y>c)break;v<c?t++:(c<M.time?g=L.MathUtils.mapLinear(c,y,M.time,0,g):c>M.end&&(g=L.MathUtils.mapLinear(c,M.end,v,g,0)),d=Math.max(g,d))}for(var _=0;_<o.current.length;_++){var w=o.current[_],O=ge(_)+i;if(w.visible=!n.isEmpty,O>a)if((O-=100)<w.position.z)ve(_,w,s.current[_],n,c);w.position.z=O,w.scale.set(1+d,1+.75*u,1)}})),Object(oe.jsx)("group",{children:c})};function we(e,r,t){var n=e%r/r*2*Math.PI;return Math.ceil(e/r)%2===0&&(n+=Math.PI/r),new L.Vector3(Math.cos(n),Math.sin(n),0).multiplyScalar(t)}var Oe=new L.SphereGeometry,Ce=new L.MeshPhongMaterial({shininess:.5});var xe=function(e){var r=0,t=0,n=Object(a.useRef)([]),o=te((function(e){return e.analysis}));Ce.color=te().theme.beat.color,Object(a.useEffect)((function(){return te.subscribe((function(e){return e.theme.beat.color}),(function(e){Ce.color=e}))}),[]);var i=fe(36).map((function(e){return Object(oe.jsx)("mesh",{ref:function(r){return n.current[e]=r},visible:!1,position:we(e,6,5),geometry:Oe,material:Ce},e)}));return Object(a.useEffect)((function(){return te.subscribe((function(e){return[e.analysis,e.audioLastSeeked]}),(function(){r=0,t=0}))}),[]),Object(de.b)((function(a,i){if(null!==e.audio.current){for(var s=e.audio.current.currentTime,c=Math.max(s-i,0),l=r;l<o.beat.length;l++){var u=o.beat[l],d=u.time-1.5;if(c>u.end+.25)r++;else{if(d>s)break;n.current[t].userData.peak=u,t=(t+1)%n.current.length,r++}}var h,b=Object(f.a)(n.current);try{for(b.s();!(h=b.n()).done;){var p=h.value,m=p.userData.peak;if(null!==m&&void 0!==m){var j=m.time-1.5,M=m.end+.25;j>s||M<c?(p.visible=!1,delete p.userData.peak):(p.visible=!0,p.position.z=L.MathUtils.mapLinear(s,j,M,-200,-10),s>=m.time&&s<M?p.scale.setScalar(L.MathUtils.mapLinear(s,m.time,M,1,2)):p.scale.setScalar(1))}else p.visible=!1}}catch(y){b.e(y)}finally{b.f()}}})),Object(oe.jsx)("group",{children:i})},ke=new L.LineBasicMaterial;var Fe=function(e){var r=-20,t=te((function(e){return e.analysis}));ke.color=te().theme.frequencyGrid.lineColor,Object(a.useEffect)((function(){return te.subscribe((function(e){return e.theme.frequencyGrid.lineColor}),(function(e){ke.color=e}))}),[]);var n=Object(a.useMemo)((function(){for(var e=[],r=-24,t=0;t<8;t++)e.push(new L.Vector3(r,0,0)),r+=1;for(var n=0;n<64;n++)e.push(new L.Vector3(r,0,0)),r+=.5;for(var a=0;a<8;a++)e.push(new L.Vector3(r,0,0)),r+=1;return e}),[]),o=Object(a.useMemo)((function(){var e=new L.BufferGeometry;return e.setFromPoints(n),e}),[n]),i=Object(a.useRef)([]),s=Object(a.useMemo)((function(){return fe(10).map((function(e){var t=new L.Line(o,ke);return t.position.set(0,-10,r*e-10),t.scale.set(.6,L.MathUtils.mapLinear(e,0,9,1,.1),1),i.current[e]=t,Object(oe.jsx)("primitive",{object:t},e)}))}),[o,-10,r,10]);return Object(de.b)((function(a,o){if(null!==e.analyser.current&&null!==e.audio.current){var s=new Uint8Array(e.analyser.current.frequencyBinCount);e.analyser.current.getByteFrequencyData(s);for(var c=0;c<s.length;c++)n[c+8].y=s[c]/255*5;for(var l=s[0]/255*5,u=s[s.length-1]/255*5,d=7;d>0;d--)l/=1.618,n[d].y=l;for(var f=72;f<n.length-1;f++)u/=1.618,n[f].y=u;var h=0,b=t.secondsPerMeasure;e.audio.current.currentTime>0&&(h=e.audio.current.currentTime%b/b);for(var p=0;p<i.current.length;p++){var m=i.current[p],j=r*p-10;m.visible=!t.isEmpty,m.geometry.setFromPoints(n),m.geometry.computeBoundingBox(),e.audio.current.currentTime>0?m.position.z=j-r*h:m.position.z=j}}})),Object(oe.jsx)("group",{children:s})},Se=t(67);var Be=function(e){var r=0,t=0,n=Object(a.useRef)([]),o=te((function(e){return e.analysis})),i=te((function(e){return e.theme.treble})),s=Object(Se.a)(i.spriteTexture),c=fe(20).map((function(e){return Object(oe.jsxs)("group",{visible:!1,ref:function(r){return n.current[e]=r},children:[Object(oe.jsx)("sprite",{scale:[15,15,1],children:Object(oe.jsx)("spriteMaterial",{color:i.spriteColor,map:s,depthWrite:!1,transparent:!0,blending:L.CustomBlending,blendEquation:L.AddEquation,blendSrc:L.SrcAlphaFactor,blendDst:L.OneFactor})}),Object(oe.jsx)("pointLight",{color:i.lightColor,castShadow:!1,distance:20})]},e)}));return Object(a.useEffect)((function(){return te.subscribe((function(e){return[e.analysis,e.audioLastSeeked]}),(function(){r=0,t=0}))}),[]),Object(de.b)((function(a,i){if(null!==e.audio.current){for(var s=e.audio.current.currentTime,c=Math.max(s-i,0),l=r;l<o.treble.length;l++){var u=o.treble[l],d=u.time-.1;if(c>u.end+.5)r++;else{if(d>s)break;var f=n.current[t];f.userData.peak=u;var h=o.getTrackSeededRandomInt(0,359,u.time)*L.MathUtils.DEG2RAD,b=o.getTrackSeededRandomInt(12,20,u.time);f.position.x=Math.cos(h)*b,f.position.y=Math.sin(h)*b,t=(t+1)%n.current.length,r++}}for(var p=0;p<n.current.length;p++){var m=n.current[p],j=m.userData.peak;if(null!==j&&void 0!==j){var M=j.time-.1,y=j.end+.5;if(M>s||y<c)m.visible=!1,delete m.userData.peak;else{m.visible=!0,m.position.z=L.MathUtils.mapLinear(s,M,y,-200,10);var v=m.children[0],g=m.children[1];if(s<j.time){var _=L.MathUtils.mapLinear(s,M,j.time,0,1);v.material.opacity=_,g.intensity=20*_}else if(s>j.end){var w=L.MathUtils.mapLinear(s,j.end,y,1,0);v.material.opacity=w,g.intensity=20*w}else v.material.opacity=1,g.intensity=20}}else m.visible=!1}}})),Object(oe.jsx)("group",{children:c})},Ae=2*Math.PI;function Le(e,r,t){for(var n=[],a=Math.max(r-e,1),o=0;o<120;o++){var i=(3*o+t)*L.MathUtils.DEG2RAD,s=e+(Math.sin(o*e)+1)*a/2,c=Math.cos(i),l=Math.sin(i);n.push(new L.Vector3(c*e,l*e,0)),n.push(new L.Vector3(c*s,l*s,0))}var u=new L.BufferGeometry;return u.setFromPoints(n),u}var Te=new L.PlaneGeometry(2048,2048);var Pe=function(e){var r=Object(Se.a)({star_first:"/edenator/backgrounds/star-01.png",star_first_glow:"/edenator/backgrounds/star-01-glow.png",star_second:"/edenator/backgrounds/star-02.png",star_second_glow:"/edenator/backgrounds/star-02-glow.png",star_third:"/edenator/backgrounds/star-03.png",star_third_glow:"/edenator/backgrounds/star-03-glow.png",horizon:"/edenator/backgrounds/horizon.png"});[r.star_first,r.star_first_glow,r.star_second,r.star_second_glow,r.star_third,r.star_third_glow].forEach((function(e){e.wrapS=e.wrapT=L.RepeatWrapping,e.repeat.setScalar(4)})),r.horizon.wrapS=r.horizon.wrapT=L.RepeatWrapping;var t=te((function(e){return e.analysis})),n=te((function(e){return e.theme.background})),o=Object(a.useMemo)((function(){return Le(100,120,0)}),[]),i=Object(a.useMemo)((function(){return Le(125,145,15)}),[]),s=Object(a.useMemo)((function(){return Le(150,170,30)}),[]),c=Object(a.useMemo)((function(){return 8*t.secondsPerMeasure}),[t]),l=Object(a.useMemo)((function(){return 16*t.secondsPerMeasure}),[t]),u=Object(a.useRef)(null),d=Object(a.useRef)(null),f=Object(a.useRef)(null),h=Object(a.useRef)(null),b=Object(a.useRef)(null),p=Object(a.useRef)(null),m=Object(a.useRef)(null),j=Object(a.useRef)(null),M=Object(a.useRef)(null),y=Object(a.useRef)(null),v=Object(a.useRef)(null);return Object(de.b)((function(r){r.scene.background=n.fillColor,j.current.visible=!t.isEmpty;var a=0,o=0;null!==e.audio.current&&(a=e.audio.current.currentTime,o=e.audio.current.duration);var i=a%c/c,s=Math.sin(i*Ae);M.current.rotation.set(0,0,s),y.current.rotation.set(0,0,.75*s),v.current.rotation.set(0,0,.5*s);var g=a%l/l,_=Math.sin(g*Ae);d.current.position.x=50*_,f.current.position.x=50*_,h.current.position.x=60*_,b.current.position.x=60*_,p.current.position.x=70*_,m.current.position.x=70*_;var w=0,O=0,C=0,x=0;if(a>0&&null!==e.analyser.current){var k=new Uint8Array(e.analyser.current.frequencyBinCount);e.analyser.current.getByteFrequencyData(k),Number.isFinite(k[15])&&(w=k[15]/255/2),Number.isFinite(k[7])&&(O=k[7]/255/4),Number.isFinite(k[31])&&(C=k[31]/255/3),Number.isFinite(k[53])&&(x=k[53]/255/5)}M.current.material.opacity=.5+w,y.current.material.opacity=.4+w,v.current.material.opacity=.3+w;var F=.95*u.current.material.opacity;F<=.01&&(F=0),u.current.material.opacity=Math.max(C,F);var S=.95*f.current.material.opacity;S<=.01&&(S=0);var B=Math.max(x,S);f.current.material.opacity=B,b.current.material.opacity=B,m.current.material.opacity=B;var A=.9*M.current.scale.x,T=Math.max(1+O,A);if(M.current.scale.x=M.current.scale.y=T,y.current.scale.x=y.current.scale.y=T,v.current.scale.x=v.current.scale.y=T,Number.isFinite(o)&&o>0){var P=L.MathUtils.mapLinear(a,0,o,.5,1.5);j.current.scale.x=j.current.scale.y=P}})),Object(oe.jsxs)("group",{children:[Object(oe.jsxs)("mesh",{ref:u,frustumCulled:!1,position:[0,0,-300],scale:[8,.125,1],children:[Object(oe.jsx)("planeGeometry",{args:[1024,512]}),Object(oe.jsx)("meshBasicMaterial",{color:n.starFlashColor,map:r.horizon,transparent:!0,opacity:0,fog:!1,depthWrite:!1,precision:"mediump"})]}),Object(oe.jsxs)("group",{ref:j,children:[Object(oe.jsx)("lineSegments",{ref:M,position:[0,0,-250],geometry:o,children:Object(oe.jsx)("lineBasicMaterial",{color:n.burstLineColor,transparent:!0,opacity:.5,fog:!1,precision:"lowp"})}),Object(oe.jsx)("lineSegments",{ref:y,position:[0,0,-250],geometry:i,children:Object(oe.jsx)("lineBasicMaterial",{color:n.burstLineColor,transparent:!0,opacity:.4,fog:!1,precision:"lowp"})}),Object(oe.jsx)("lineSegments",{ref:v,position:[0,0,-250],geometry:s,children:Object(oe.jsx)("lineBasicMaterial",{color:n.burstLineColor,transparent:!0,opacity:.3,fog:!1,precision:"lowp"})})]}),Object(oe.jsxs)("group",{children:[Object(oe.jsx)("mesh",{ref:f,position:[0,0,-599],scale:[2,2,1],frustumCulled:!1,geometry:Te,children:Object(oe.jsx)("meshBasicMaterial",{color:n.starFlashColor,map:r.star_first_glow,transparent:!0,opacity:0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(oe.jsx)("mesh",{ref:d,position:[0,0,-600],scale:[2,2,1],frustumCulled:!1,geometry:Te,children:Object(oe.jsx)("meshBasicMaterial",{color:n.starColor,map:r.star_first,transparent:!0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(oe.jsx)("mesh",{ref:b,position:[0,0,-699],scale:[2,2,1],frustumCulled:!1,geometry:Te,children:Object(oe.jsx)("meshBasicMaterial",{color:n.starFlashColor,map:r.star_second_glow,transparent:!0,opacity:0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(oe.jsx)("mesh",{ref:h,position:[0,0,-700],scale:[2,2,1],frustumCulled:!1,geometry:Te,children:Object(oe.jsx)("meshBasicMaterial",{color:n.starColor,map:r.star_second,transparent:!0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(oe.jsx)("mesh",{ref:m,position:[0,0,-799],scale:[2,2,1],frustumCulled:!1,geometry:Te,children:Object(oe.jsx)("meshBasicMaterial",{color:n.starFlashColor,map:r.star_third_glow,transparent:!0,opacity:0,fog:!1,depthWrite:!1,precision:"lowp"})}),Object(oe.jsx)("mesh",{ref:p,position:[0,0,-800],scale:[2,2,1],frustumCulled:!1,geometry:Te,children:Object(oe.jsx)("meshBasicMaterial",{color:n.starColor,map:r.star_third,transparent:!0,fog:!1,depthWrite:!1,precision:"lowp"})})]})]})},Ee=t(35),Re=t(10);var De=function(e){var r=Object(a.useRef)(null);return Object(de.b)((function(){if(!(null===e.audio.current||e.audio.current.currentTime<=0||null===e.analyser.current||null===r.current)){var t=new Uint8Array(e.analyser.current.frequencyBinCount);e.analyser.current.getByteFrequencyData(t);var n=r.current.godRaysPass.getFullscreenMaterial();if(Number.isFinite(t[5])){var a=t[5]/255;n.uniforms.decay.value=L.MathUtils.lerp(.4,.93,a),n.uniforms.exposure.value=L.MathUtils.lerp(.4,.85,a)}else n.uniforms.decay.value=.4,n.uniforms.exposure.value=.4}})),Object(oe.jsxs)(Ee.b,{children:[Object(oe.jsx)(Ee.a,{intensity:1,width:Re.y.AUTO_SIZE,height:Re.y.AUTO_SIZE,kernelSize:Re.r.MEDIUM,luminanceThreshold:.4,luminanceSmoothing:.1}),Object(oe.jsx)(Ee.c,{ref:r,sun:e.sunMesh,blur:10,blendFunction:Re.a.Screen,samples:60,density:.85,decay:.85,weight:.4,exposure:.4,clampMax:1,width:Re.y.AUTO_SIZE,height:Re.y.AUTO_SIZE,kernelSize:Re.r.MEDIUM})]})},Ge=new L.MeshBasicMaterial({transparent:!0,fog:!1}),Ve=new L.Mesh(new L.SphereGeometry(5),Ge);Ve.frustumCulled=!1,Ve.position.set(0,0,-200);var qe=function(e){return Ge.color=te.getState().theme.background.sunColor,Object(a.useEffect)((function(){return te.subscribe((function(e){return e.theme.background.sunColor}),(function(e){Ge.color=e}))}),[]),Object(oe.jsxs)(de.a,{camera:{position:[0,0,15]},children:[Object(oe.jsx)("ambientLight",{intensity:.1}),Object(oe.jsx)("directionalLight",{position:[0,0,20]}),Object(oe.jsx)("primitive",{object:Ve}),Object(oe.jsx)(_e,{audio:e.audio}),Object(oe.jsx)(xe,{audio:e.audio}),Object(oe.jsx)(Fe,{audio:e.audio,analyser:e.analyser}),Object(oe.jsx)(Be,{audio:e.audio}),Object(oe.jsx)(Pe,{audio:e.audio,analyser:e.analyser}),Object(oe.jsx)(De,{audio:e.audio,analyser:e.analyser,sunMesh:Ve})]})};var Ue=function(){var e="",r=te((function(e){return e.setAnalysis})),t=te((function(e){return e.setTheme})),o=te((function(e){return e.indicateAudioSeeked})),i=Object(a.useRef)(new AudioContext),s=Object(a.useRef)(null),l=Object(a.useRef)(null),u=Object(a.useRef)(null),d=Object(a.useState)(""),f=Object(c.a)(d,2),h=f[0],b=f[1],p=Object(a.useRef)(null),m=Object(a.useRef)(null),j=Object(a.useRef)(new WeakMap),M=Object(a.useCallback)((function(e){if(null!=e){var r;j.current.has(e)?r=j.current.get(e):(r=new MediaElementAudioSourceNode(i.current,{mediaElement:e}),j.current.set(e,r));var t=new AnalyserNode(i.current,{fftSize:128});r.connect(t),t.connect(i.current.destination),p.current=e,m.current=t}}),[i]);return Object(a.useEffect)((function(){return te.subscribe((function(e){return e.analysis}),(function(e){null===e||e.isEmpty||""===e.artist||""===e.title?document.title="Edenator":document.title="Edenator (".concat(e.artist," - ").concat(e.title,")")}))}),[]),Object(oe.jsxs)("div",{children:[Object(oe.jsx)(ue,{}),Object(oe.jsxs)("div",{ref:s,className:"app-title",children:[Object(oe.jsx)("h1",{children:"Edenator"}),Object(oe.jsx)("p",{children:"Start by choosing a song."}),Object(oe.jsx)("p",{children:Object(oe.jsx)("strong",{children:Object(oe.jsx)("em",{children:"The visuals used by this application may not be suitable for people with photosensitive epilepsy."})})})]}),Object(oe.jsxs)("div",{className:"app-error",hidden:!h,children:[h,Object(oe.jsx)("button",{type:"button",onClick:function(){return b("")},children:"Dismiss"})]}),Object(oe.jsxs)("div",{id:"filePicker",children:[Object(oe.jsx)("button",{type:"button",ref:u,id:"dummyFilePicker",onClick:function(){l.current.click()},children:"Choose a track"}),Object(oe.jsx)("input",{type:"file",ref:l,id:"sourceFile","aria-label":"Choose an audio file",accept:"audio/*",onChange:function(){var a,c;if(1===(null===(a=l.current)||void 0===a||null===(c=a.files)||void 0===c?void 0:c.length)){u.current.disabled=!0,u.current.innerText="Analyzing...",l.current.disabled=!0,l.current.readOnly=!0,b(""),p.current&&(p.current.pause(),p.current.controls=!1);var d=l.current.files[0];(function(e){return F.apply(this,arguments)})(d).then((function(a){var c=URL.createObjectURL(d);if(null!==p.current){p.current.src=c,p.current.load();var l=i.current.resume(),u=p.current.play();void 0!==l&&void 0!==u&&Promise.all([l,u]).then((function(){})).catch((function(){window.setTimeout((function(){i.current&&p.current&&(i.current.resume(),p.current.play())}))}))}""!==e&&URL.revokeObjectURL(e),e=c,s.current.hidden=!0,r(a),t(function(e){if(null===e)return G;if(null===e.key){var r=e.getTrackRandomInt(0,ee.length-1);return ee[r]}switch(e.key){case n.C_Major:case n.A_Minor:return V;case n.G_Major:case n.E_Minor:return q;case n.D_Major:case n.B_Minor:return N;case n.A_Major:case n.F_Sharp_Minor:return I;case n.E_Major:case n.C_Sharp_Minor:return U;case n.B_Major:case n.G_Sharp_Minor:return z;case n.F_Sharp_Major:case n.D_Sharp_Minor:return X;case n.D_Flat_Major:case n.B_Flat_Minor:return W;case n.A_Flat_Major:case n.F_Minor:return H;case n.E_Flat_Major:case n.C_Minor:return K;case n.B_Flat_Major:case n.G_Minor:return Y;case n.F_Major:case n.D_Minor:return Z;case n.OffKey:return J;default:return G}}(a)),o()})).catch((function(e){console.error(e),b('Error opening "'.concat(null===d||void 0===d?void 0:d.name,'":\n').concat(e.toString()))})).finally((function(){l.current&&(l.current.disabled=!1,l.current.readOnly=!1),u.current&&(u.current.disabled=!1,u.current.innerText="Choose a track"),p.current&&p.current.src&&(p.current.controls=!0)}))}}})]}),Object(oe.jsx)("button",{type:"button",id:"themeCycler",onClick:function(){var e=function(e){var r=ee.indexOf(e);return-1===r||r===ee.length-1?ee[0]:ee[r+1]}(te.getState().theme);t(e)},children:"Switch theme"}),Object(oe.jsx)("audio",{ref:M,id:"audioPlayer",onSeeked:o}),Object(oe.jsx)("div",{id:"canvas-container",children:Object(oe.jsx)(a.Suspense,{fallback:null,children:Object(oe.jsx)(qe,{audio:p,analyser:m})})}),!1]})},Ie=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,68)).then((function(r){var t=r.getCLS,n=r.getFID,a=r.getFCP,o=r.getLCP,i=r.getTTFB;t(e),n(e),a(e),o(e),i(e)}))};s.a.render(Object(oe.jsx)(o.a.StrictMode,{children:Object(oe.jsx)(Ue,{})}),document.getElementById("root")),Ie()}},[[66,1,2]]]);
//# sourceMappingURL=main.10ce4cdf.chunk.js.map